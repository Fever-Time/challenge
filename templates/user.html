<!DOCTYPE html>
<html lang="en">
<head>
    <!-- meta -->
    {% include "include/header-meta.html" %}

    <!-- title -->
    <title>í”¼ë²„íƒ€ì„</title>

    {% include "include/header-css.html" %}

    <style>
        .table-body-row {
            cursor: pointer;
        }

        .table-body-row:hover {
            background-color: #F28123;
        }

        #delete-user-btn {
            background-color: crimson;
            margin-left: 10px;
        }

        #delete-user-btn:hover {
            color: crimson;
            background-color: black;
        }

        #logout-user-btn {
            background-color: #28a745;
            margin-right: 10px;
        }

        #logout-user-btn:hover {
            color: #28a745;
            background-color: black;
        }

        #pwdHelp {
            font-size: 15px;
        }

        .change {
            pointer-events: none;
            background-color: gray;
        }

        .unregister {
            background-color: red;
        }

        #unregister_edit:hover {
            background-color: red;
        }

        .canChange, .canEdit {
            color: green !important;
        }

        a.read-more-btn {
            margin-top: 0;
        }

        .shipping-address-form {
            display: flex;
            justify-content: space-around;
        }

    </style>

    <script>
        let delete_cookie = function (name) {
            document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        };

        function sign_out() {
            delete_cookie('fever-time')
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.')
            location.href = '/'
        }

        function onClickChallenge(challengeId) {
            location.href = `/challenge/${challengeId}`
        }

        function unregister_check_pwd() { // íšŒì›íƒˆí‡´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            {% if kakaoLogin %}
                let kakao_pwd = $('#unregister_kakaoPwd').val()
                if (kakao_pwd === 'íšŒì›íƒˆí‡´') {
                    $('#unregister_edit').removeClass('change')
                    $('#unregister_edit').addClass('unregister')
                } else {
                    $('#unregister_edit').addClass('change')
                    $('#unregister_edit').removeClass('unregister')
                }

            {% else %}
                let pwd = $('#unregister_nowPwd').val();
                console.log(pwd)
                $.ajax({
                    type: "POST",
                    url: '/check_pwd',
                    data: {'pwd': pwd},
                    success: function (response) {
                        if (response['result']) {
                            $('#unregister_pwdHelp').text('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤ âœ”')
                            $('#unregister_pwdHelp').addClass('canChange');
                            $('#unregister_edit').removeClass('change');
                            $('#unregister_edit').addClass('unregister');
                        } else {
                            $('#unregister_pwdHelp').text('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                            $('#unregister_edit').addClass('change');
                            $('#unregister_pwdHelp').removeClass('canChange');
                            $('#unregister_edit').removeClass('unregister');
                        }
                    }
                });
            {% endif %}
        }

        function check_pwd() { // í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            let pwd = $('#nowPwd').val();
            console.log(pwd)
            $.ajax({
                type: "POST",
                url: '/check_pwd',
                data: {'pwd': pwd},
                success: function (response) {
                    if (response['result']) {
                        $('#pwdHelp').text('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤ âœ”')
                        $('#pwdHelp').addClass('canChange');
                        if ($('#changePwd').val() !== "" && $('#doubleCheckPwd').val() !== "") {
                            $('#edit').removeClass('change');
                        }
                    } else {
                        $('#pwdHelp').text('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        $('#edit').addClass('change');
                        $('#pwdHelp').removeClass('canChange');
                    }
                }
            });
        }

        function is_password(asValue) { // ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹
            const regExp = /^(?=.*\d)(?=.*[a-zA-Z])[0-9a-zA-Z!@#$%^&*]{8,20}$/;
            return regExp.test(asValue);
        }

        function change_pwd() { // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
            let pwd = $('#changePwd').val(); // ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸
            let samePwd = $('#doubleCheckPwd').val(); // í•œë²ˆ ë” ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸
            if (samePwd !== "") doubleCheck_pwd();

            if (!is_password(pwd)) {
                $('#regHelp').text('ë¹„ë°€ë²ˆí˜¸ì˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì˜ë¬¸ê³¼ ìˆ«ì í•„ìˆ˜ í¬í•¨, íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*) ì‚¬ìš©ê°€ëŠ¥ 8-20ì"')
                $('#regHelp').removeClass('canChange');
            } else {
                $('#regHelp').text('ë³´ì•ˆì´ ì² ì €í•©ë‹ˆë‹¤ ğŸ”’');
                $('#regHelp').addClass('canChange');

            }
        }

        function doubleCheck_pwd() { // ë¹„ë°€ë²ˆí˜¸ ë”ë¸” ì²´í¬
            let pwd = $('#changePwd').val(); // ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸
            let samePwd = $('#doubleCheckPwd').val(); // í•œë²ˆ ë” ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸

            if (pwd != samePwd) {
                $("#regDoubleHelp").text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                $('#regDoubleHelp').removeClass('canEdit');
            } else {
                $("#regDoubleHelp").text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤ âœ”");
                $('#regDoubleHelp').addClass('canEdit');
            }
            if ($('#regDoubleHelp').hasClass('canEdit') && $('#pwdHelp').hasClass('canChange') && $('#regHelp').hasClass('canChange')) {
                $('#edit').removeClass('change');
            } else {
                $('#edit').addClass('change');
            }
        }

        function edit_pwd() { // ìˆ˜ì •í•˜ê¸° ëˆŒë €ì„ ë•Œ
            if ($('#regDoubleHelp').hasClass('canEdit') && $('#pwdHelp').hasClass('canChange') && $('#regHelp').hasClass('canChange')) {
                let pwd = $('#changePwd').val(); // ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸

                $.ajax({
                    type: "PUT",
                    url: `/change_pwd?pwd=${pwd}`,
                    data: {},
                    success: function (response) {
                        if (response['result'] === 'success') {
                            alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ');
                            window.location.reload();
                        } else {
                            alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            window.location.reload();
                        }
                    }
                });
            }
        }

        function unregister() {
            let check = confirm("ì±Œë¦°ì €ì˜ ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ëŠ” ê²ƒì— ë™ì˜í•˜ì‹­ë‹ˆê¹Œ?")
            if (check) {
                $.ajax({
                    type: "POST",
                    url: "/unregister",
                    data: {},
                    success: function (response) {
                        delete_cookie('fever-time')
                        alert(response['result'])
                        window.location.href = "/login";
                    }
                })
            } else {
                alert("ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤ !!")
                window.location.href = "/user"
            }
        }

        function updateUserName() {
            let name = prompt("ë³€ê²½í•  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.")

            if (name != null) {
                $.ajax({
                    type: "POST",
                    url: "/user/name",
                    data: {"name_give": name},
                    success: function (response) {
                        let result = response['msg']
                        window.location.reload();
                    }
                })
            }
        }
    </script>
</head>
<body>
<!--PreLoader start -->
{% include 'include/preloader.html' %}
<!--PreLoader end-->

<!-- header -->
<div class="top-header-area" id="sticker">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-sm-12 text-center">
                <div class="main-menu-wrap">
                    <!-- logo -->
                    <div class="site-logo">
                        <a href="{{ '/' }}">
                            <img src="{{ url_for('static', filename='assets/img/logo.png') }}" alt="">
                        </a>
                    </div>
                    <!-- logo -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end header -->

<!-- search area start-->
{% include 'include/search.html' %}
<!-- search area end -->

<!-- breadcrumb-section start -->
{% include 'include/breadcrumb-section.html' %}
<!-- breadcrumb section end -->

<!-- cart -->
<div class="cart-section mt-150 mb-150">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-12">

                <div class="checkout-accordion-wrap" style="padding-bottom: 10px">
                    <div class="accordion" id="accordionExample">
                        <div class="card single-accordion">
                            <div class="card-header" id="headingTwo">
                                <h5 class="mb-0">
                                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                            data-target="#collapseTwo" aria-expanded="false"
                                            aria-controls="collapseTwo">
                                        My Profile
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo"
                                 data-parent="#accordionExample">
                                <div class="card-body">
                                    <div class="shipping-address-form">
                                        {% if kakaoLogin %}
                                            <p>{{ user.user_name }}</p>
                                        {% else %}
                                            <p>{{ user.user_name+'('+user.user_email+')' }}</p>
                                        {% endif %}
                                        <a onclick="updateUserName()" class="read-more-btn">ì´ë¦„ ë³€ê²½ <i
                                                class="fas fa-angle-right"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cart-table-wrap">
                    <table class="cart-table">
                        <thead class="cart-table-head">
                        <tr class="table-head-row">
                            <th class="product-image">Challenge Image</th>
                            <th class="product-name">Challenge Title</th>
                            <th class="product-price">Challenge Period</th>
                            {#                            <th class="product-total">Challenge Day</th>#}
                        </tr>
                        </thead>

                        <tbody>
                        {% for challenge in challenges %}
                            <tr class="table-body-row" onclick="onClickChallenge('{{ challenge._id }}')">

                                <td class="product-image">
                                    <img src="{{ 'https://dybzsbdm9g4zq.cloudfront.net/'+challenge.challenge_img }}"
                                         alt="">
                                </td>
                                <td class="product-name">{{ challenge.challenge_title }}</td>
                                <td class="product-price">
                                    {% if challenge.challenge_status==1 %}
                                        <i class="far fa-calendar-alt"></i>
                                        {{ challenge.challenge_startTime +' ~ '+ challenge.challenge_endTime }} (ì¤‘ë‹¨)
                                    {% else %}
                                        <i class="far fa-calendar-alt"></i>
                                        {{ challenge.challenge_startTime +' ~ '+ challenge.challenge_endTime }}
                                    {% endif %}
                                </td>
                                {#                                <td class="product-total">50%</td>#}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>

            <div class="col-lg-4">
                <div class="total-section">
                    <table class="total-table">
                        <thead class="total-table-head">
                        <tr class="table-total-row">
                            <th>êµ¬ë¶„</th>
                            <th>ê²°ê³¼</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="total-data">
                            <td><strong>ì§„í–‰ ì±Œë¦°ì§€</strong></td>
                            <td>{{ challenge_cnt.ing }}</td>
                        </tr>
                        <tr class="total-data">
                            <td><strong>ì¤‘ë‹¨ ì±Œë¦°ì§€</strong></td>
                            <td>{{ challenge_cnt.pause }}</td>
                        </tr>
                        <tr class="total-data">
                            <td><strong>ì¤‘ë£Œ ì±Œë¦°ì§€</strong></td>
                            <td>{{ challenge_cnt.end }}</td>
                        </tr>
                        {#                        <tr class="total-data">#}
                        {#                            <td><strong>ì „ì²´ ë‹¬ì„±ë¥ </strong></td>#}
                        {#                            <td>99%</td>#}
                        {#                        </tr>#}
                        </tbody>
                    </table>
                    <div class="cart-buttons">
                        <a href="#" id="logout-user-btn" class="boxed-btn" onclick="sign_out()">ë¡œê·¸ì•„ì›ƒ</a>
                        <a href="#" class="boxed-btn" data-toggle="modal" data-target="#editModal">ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •</a>
                        {% if kakaoLogin %}
                            <a href="#" id="delete-user-btn" class="boxed-btn black" data-toggle="modal"
                               data-target="#unregister_kakao">íšŒì›íƒˆí‡´</a>
                        {% else %}
                            <a href="#" id="delete-user-btn" class="boxed-btn black" data-toggle="modal"
                               data-target="#unregister">íšŒì›íƒˆí‡´</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end cart -->

<!-- ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ëª¨ë‹¬-->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="exampleInputEmail1">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" class="form-control" id="nowPwd" onkeyup="check_pwd()"
                               aria-describedby="emailHelp"
                               placeholder="Now your Password">
                        <small id="pwdHelp" class="form-text text-muted"></small>
                    </div>
                    <div class="form-group">
                        <label for="exampleInputPassword1">ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" class="form-control" id="changePwd" onkeyup="change_pwd()"
                               placeholder="Password">
                        <small id="regHelp" class="form-text text-muted"></small>
                    </div>
                    <div class="form-group">
                        <label for="exampleInputPassword1">í•œë²ˆ ë” ì…ë ¥í•´ì£¼ì„¸ìš”</label>
                        <input type="password" class="form-control" id="doubleCheckPwd" onkeyup="doubleCheck_pwd()"
                               placeholder="Password">
                        <small id="regDoubleHelp" class="form-text text-muted"></small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary change" id="edit" onclick="edit_pwd()">ìˆ˜ì •í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>
<!-- end Modal-->

<!-- ì¹´ì¹´ì˜¤ íšŒì›íƒˆí‡´ ëª¨ë‹¬-->
{% if kakaoLogin %}
    <div class="modal fade" id="unregister_kakao" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">íšŒì›íƒˆí‡´</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">'íšŒì›íƒˆí‡´'ë¥¼ ì ì–´ì£¼ì„¸ìš”</label>
                            <input type="text" class="form-control" id="unregister_kakaoPwd"
                                   aria-describedby="emailHelp" onkeyup="unregister_check_pwd()"
                                   placeholder="íšŒì›íƒˆí‡´">
                            <small id="unregister_pwdHelp" class="form-text text-muted"></small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary change" id="unregister_edit" onclick="unregister()">
                        íšŒì›íƒˆí‡´
                    </button>
                </div>
            </div>
        </div>
    </div>
{% else %}
    <!-- ì´ë©”ì¼ íšŒì›íƒˆí‡´ ëª¨ë‹¬-->
    <div class="modal fade" id="unregister" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">ë³¸ì¸ì¸ì¦</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" id="unregister_nowPwd"
                                   onkeyup="unregister_check_pwd()"
                                   aria-describedby="emailHelp"
                                   placeholder="Now your Password">
                            <small id="unregister_pwdHelp" class="form-text text-muted"></small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary change" id="unregister_edit" onclick="unregister()">
                        íšŒì›íƒˆí‡´
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endif %}
<!-- end Modal-->

<!-- copyright start -->
{% include 'include/copyright.html' %}
<!-- copyright end -->

<!-- bootstrap js start -->
{% include 'include/footer-js.html' %}
<!-- bootstrap js end -->
</body>
</html>